# Construction Material Semantic Search API üèóÔ∏è# Construction Material Semantic Search API üèóÔ∏è



Microservice for semantic search of construction materials. Uses AI to find relevant products from natural language queries.Semantic search microservice for construction materials. Uses AI embeddings to find relevant products from natural language queries.



**Current Status:** 503 materials indexed from MongoDB**Live API:** `http://your-api-url.com` (deploy to get URL)  

**Docs:** `http://your-api-url.com/docs`

## üöÄ Quick Start

## What It Does

```bash

# Install dependenciesSearch 500+ construction materials using plain English:

pip install -r requirements.txt- "cement for foundation work" ‚Üí Returns cement products

- "waterproofing for roof" ‚Üí Returns waterproofing materials

# Configure .env file- "steel rods" ‚Üí Returns steel products

MONGODB_URI=your_mongodb_connection_string

MONGODB_DATABASE=product**Embeddings are stored in MongoDB** - no cache files needed!

MONGODB_COLLECTION=products

## üöÄ Quick Start

# Run locally

uvicorn api:app --reload### 1. Setup

``````bash

# Clone and install

Visit **http://localhost:8000/docs** for interactive API documentation.git clone https://github.com/Aryannnthakurrr/Materialmover.git

cd materialmoversearch

---pip install -r requirements.txt



## üì° API Endpoints# Configure MongoDB

cp .env.example .env

| Method | Endpoint | Description |# Edit .env with your MongoDB connection string

|--------|----------|-------------|```

| `GET` | `/search` | Search materials with query params |

| `POST` | `/search` | Search materials with JSON body |### 2. Run Locally

| `GET` | `/health` | Check API status |```bash

| `POST` | `/rebuild-cache` | Regenerate all embeddings |uvicorn api:app --reload

| `POST` | `/webhooks/product-created` | Notify of new product |```

| `POST` | `/webhooks/product-updated` | Notify of updated product |

Visit http://localhost:8000/docs to test the API

### Example Search

## üì° API Endpoints

```bash

# Query```bash

curl "http://localhost:8000/search?query=cement%20bags&top_k=5"# Search materials

GET  /search?query=cement&top_k=5

# ResponsePOST /search

{

  "query": "cement bags",# Check status

  "results": [GET  /health

    {

      "id": "507f...",# Admin - rebuild all embeddings

      "title": "Portland Cement 50kg",POST /rebuild-cache

      "description": "High-quality cement...",

      "price": 250.0,# Webhooks - for MERN app integration

      "category": "Cement",POST /webhooks/product-created

      "similarity_score": 0.89POST /webhooks/product-updated

    }```

  ],

  "count": 1**Example:**

}```bash

```curl "http://localhost:8000/search?query=cement%20bags&top_k=5"

```

---

**Response:**

## üîó Integration with MERN App```json

{

Call webhooks when products are added/updated:  "query": "cement bags",

  "results": [

```javascript    {

// After creating a product      "id": "507f...",

const newProduct = await Product.create({...});      "title": "Portland Cement 50kg",

      "description": "High-quality cement...",

// Notify search API (optional - auto-indexed on restart if skipped)      "price": 250.0,

await axios.post('http://your-api-url/webhooks/product-created', {      "category": "Cement",

  product_id: newProduct._id.toString()      "similarity_score": 0.89

});    }

```  ],

  "count": 1

**Without webhooks:** New products are auto-indexed on next API restart.}

```

---

## üîó Integration with MERN App

## üíæ How It Works

Your friend's app should call these webhooks when products change:

1. **Embeddings stored in MongoDB** alongside product data

2. **First startup:** Generates embeddings for all products (~1-2 min for 500 products)```javascript

3. **Subsequent startups:** Loads embeddings from MongoDB (~2 seconds)// Node.js backend - when creating a product

4. **Search:** Compares query embedding with stored embeddings using cosine similarityconst newProduct = await Product.create({...});



### MongoDB Document Structure// Notify search API (optional but recommended)

await axios.post('http://your-api.com/webhooks/product-created', {

```javascript  product_id: newProduct._id.toString()

{});

  "_id": ObjectId("..."),

  "title": "Portland Cement",// Now the product is immediately searchable!

  "description": "...",```

  "price": 250,

  "category": "Cement",Without webhooks, new products are auto-indexed on API restart.

  // Auto-generated by API:

  "embedding": [0.123, -0.456, ...],  // 384 floats## Response Format

  "embedding_model": "all-MiniLM-L6-v2"

}Successful search response:

``````json

{

---  "query": "cement for foundation",

  "results": [

## üöÄ Deployment    {

      "id": "507f1f77bcf86cd799439011",

### Option 1: Render (Recommended - Free)      "title": "Portland Cement",

      "description": "High-quality cement for construction...",

1. Create `requirements.txt`:      "price": 250.0,

   ```bash      "quantity": 500,

   pip freeze > requirements.txt      "category": "Cement",

   ```      "image": "https://example.com/image.jpg",

      "similarity_score": 0.8532

2. Push to GitHub    }

  ],

3. Go to [render.com](https://render.com) ‚Üí New Web Service  "count": 1

}

4. Configure:```

   - Build: `pip install -r requirements.txt`

   - Start: `uvicorn api:app --host 0.0.0.0 --port $PORT`## Example Queries

   - Add environment variables (MONGODB_URI, etc.)

Try these natural language queries:

5. Deploy! Your API will be at: `https://your-app.onrender.com`- "cement for foundation work"

- "steel rods for reinforcement"

### Option 2: Railway- "waterproofing material for roof"

- "paint for exterior walls"

1. Go to [railway.app](https://railway.app)- "tiles for bathroom flooring"

2. Deploy from GitHub repo- "sand for concrete mixing"

3. Add environment variables- "bricks for wall construction"

4. Done!- "adhesive for tile installation"

- "plywood for furniture making"

### Option 3: Docker- "metal pipes for plumbing"



```dockerfile## Architecture

FROM python:3.11-slim

WORKDIR /app### Components

COPY requirements.txt .

RUN pip install -r requirements.txt1. **api.py**: FastAPI application with REST endpoints

COPY . .2. **lib/semantic_search.py**: Core semantic search engine

EXPOSE 80003. **MongoDB Atlas**: Construction materials database

CMD ["uvicorn", "api:app", "--host", "0.0.0.0", "--port", "8000"]4. **cache/**: Cached embeddings for fast search

```

### How It Works

```bash

docker build -t material-search-api .1. On first startup, the API connects to MongoDB Atlas

docker run -p 8000:8000 --env-file .env material-search-api2. It fetches all construction materials from the database

```3. It generates embeddings for all materials using sentence-transformers

4. Embeddings are cached to disk for fast subsequent startups

---5. Search queries are embedded and compared using cosine similarity

6. Top matching materials are returned with similarity scores and details

## üîß Configuration

### Model

### Environment Variables

Uses `all-MiniLM-L6-v2` from sentence-transformers:

```bash- Fast and efficient

MONGODB_URI=mongodb+srv://user:pass@cluster.mongodb.net/db- Good balance of speed and accuracy

MONGODB_DATABASE=product- 384-dimensional embeddings

MONGODB_COLLECTION=products- Works well for semantic search

```

## Development

### MongoDB Atlas Setup

### Project Structure

1. Whitelist IP: `0.0.0.0/0` (for cloud deployment)

2. Create database user with read permissions```

3. Get connection stringmaterialmoversearch/

‚îú‚îÄ‚îÄ api.py                  # Main FastAPI application

---‚îú‚îÄ‚îÄ lib/

‚îÇ   ‚îî‚îÄ‚îÄ semantic_search.py  # Search engine implementation

## ‚ö° Performance‚îú‚îÄ‚îÄ .env                    # MongoDB connection credentials

‚îú‚îÄ‚îÄ cache/                  # Auto-generated embeddings cache

- **First startup:** 30-60 seconds (generates embeddings)‚îú‚îÄ‚îÄ main.py                 # Info script (run for instructions)

- **Subsequent startups:** 2-3 seconds (loads from MongoDB)‚îú‚îÄ‚îÄ pyproject.toml          # Dependencies

- **Search latency:** <100ms‚îú‚îÄ‚îÄ README.md               # Full documentation

- **Storage:** ~2.5KB per product (1.5KB for embedding)‚îî‚îÄ‚îÄ QUICKSTART.md           # Quick start guide

- **Current:** 503 products = ~1.25MB in MongoDB```



---### Updating Materials



## üîí Security (Optional)Materials are stored in MongoDB Atlas. To update the search index after changing the database:



Add API key authentication:```bash

curl -X POST "http://localhost:8000/rebuild-cache"

```python```

# In api.py

API_KEY = os.getenv("API_KEY")This will fetch the latest materials from MongoDB and regenerate the embeddings.



@app.get("/search")### Configuration

async def search(x_api_key: str = Header(...)):

    if x_api_key != API_KEY:You can customize the search engine by modifying `lib/semantic_search.py`:

        raise HTTPException(401, "Invalid API key")- Change the model: `model_name` parameter

    # ... rest of code- Adjust cache location: `cache_dir` parameter

```- Modify search parameters: `top_k`, `min_score`



---## Production Deployment



## üìä Tech Stack### Using Docker (Recommended)



- **FastAPI** - Web frameworkCreate a `Dockerfile`:

- **Sentence-Transformers** - AI embeddings (all-MiniLM-L6-v2)```dockerfile

- **MongoDB Atlas** - Database + embedding storageFROM python:3.11-slim

- **NumPy** - Vector similarity calculations

- **Python 3.11+**WORKDIR /app

COPY . .

---

RUN pip install -e .

## üÜò Troubleshooting

EXPOSE 8000

**New products not searchable?**CMD ["uvicorn", "api:app", "--host", "0.0.0.0", "--port", "8000"]

- Use webhooks, OR```

- Restart API, OR

- Call `/rebuild-cache`Build and run:

```bash

**Slow first startup?**docker build -t material-search-api .

- Normal! Generating embeddings for all productsdocker run -p 8000:8000 -e MONGODB_URI="your-connection-string" material-search-api

- Subsequent startups are fast```



**MongoDB connection failed?**### Using Production ASGI Server

- Check `.env` credentials

- Verify IP whitelist in MongoDB Atlas```bash

- Test with MongoDB Compass# Install gunicorn

pip install gunicorn

---

# Run with multiple workers

## üìù Licensegunicorn api:app --workers 4 --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000

```

MIT

### Environment Variables

---

Set these for production (create a `.env` file):

**Questions?** Check `/docs` endpoint for interactive API documentation.```bash

MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/database
MONGODB_DATABASE=product
MONGODB_COLLECTION=Material-Mover
CORS_ORIGINS=https://yourdomain.com
```

## Performance

- **First startup**: 30-60 seconds (fetches from MongoDB, builds embeddings cache)
- **Subsequent startups**: 1-2 seconds (loads from cache)
- **Search latency**: < 100ms for typical queries
- **Throughput**: ~100-500 requests/second (single worker)
- **Database**: ~1000 construction materials indexed

## Troubleshooting

### Cache Issues
If you encounter cache-related errors, delete the cache folder:
```bash
rm -rf cache/
```
The cache will be rebuilt on next startup.

### Memory Usage
The API loads all embeddings into memory. For very large databases (>100k materials), consider:
- Using a vector database (Pinecone, Weaviate, Qdrant)
- Implementing batch processing
- Increasing server RAM

### MongoDB Connection Issues
If you can't connect to MongoDB:
- Check your connection string in `.env`
- Verify network access in MongoDB Atlas (whitelist your IP)
- Ensure credentials are correct
- Test connection with MongoDB Compass

### Model Download
On first run, sentence-transformers downloads the model (~90MB). Ensure:
- Internet connection is available
- Sufficient disk space (~500MB)
- No firewall blocking HuggingFace downloads

## Contributing

Contributions are welcome! Please:
1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Submit a pull request

## License

MIT License - feel free to use in your projects!

## Support

For issues or questions:
- Open an issue on GitHub
- Check the interactive docs at `/docs`
- Review the examples in this README

---

Built with ‚ù§Ô∏è using FastAPI and sentence-transformers
